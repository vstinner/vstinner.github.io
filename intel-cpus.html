<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Intel CPUs: P-state, C-state, Turbo Boost, CPU frequency, etc. â€” Victor Stinner blog 3</title>
	<meta name="description" content="Title: Intel CPUs: P-state, C-state, Turbo Boost, CPU frequency, etc.; Date: 2016-07-15; Author: Victor Stinner">
	<meta name="author" content="Victor Stinner">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="https://vstinner.github.io/theme/html5.js"></script>
		<![endif]-->
	<link href="https://vstinner.github.io/theme/css/ipython.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="https://vstinner.github.io/theme/css/local.css" rel="stylesheet">
	<link href="https://vstinner.github.io/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<div class="page-header">
		<h1><a href="https://vstinner.github.io/">Victor Stinner blog 3</a>
			<br>	</div>
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Intel CPUs: P-state, C-state, Turbo Boost, CPU frequency, etc.</h1>
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<h4 itemprop="name">Victor Stinner</h4>
		</span>
		<time datetime="2016-07-15T12:00:00+02:00" itemprop="datePublished">Fri 15 July 2016</time>
	</div>
	<div>
		Category:
		<span itemprop="articleSection">
			<a href="https://vstinner.github.io/category/benchmark.html" rel="category">benchmark</a>
		</span>
	</div>
 
	<div>
		Tags:
		<span itemprop="keywords">
			<a href="https://vstinner.github.io/tag/optimization.html" rel="tag">optimization</a>
		</span>
		<span itemprop="keywords">
			<a href="https://vstinner.github.io/tag/benchmark.html" rel="tag">benchmark</a>
		</span>
		<span itemprop="keywords">
			<a href="https://vstinner.github.io/tag/cpu.html" rel="tag">cpu</a>
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>Ten years ago, most computers were desktop computers designed for best
performances and their CPU frequency was fixed. Nowadays, most devices are
embedded and use <a class="reference external" href="https://en.wikipedia.org/wiki/Low-power_electronics">low power consumption</a> processors like ARM
CPUs. The power consumption now matters more than performance peaks.</p>
<p>Intel CPUs evolved from a single core to multiple physical cores in the same
<a class="reference external" href="https://en.wikipedia.org/wiki/CPU_socket">package</a> and got new features:
<a class="reference external" href="https://en.wikipedia.org/wiki/Hyper-threading">Hyper-threading</a> to run two
threads on the same physical core and <a class="reference external" href="https://en.wikipedia.org/wiki/Intel_Turbo_Boost">Turbo Boost</a> to maximum performances.
CPU cores can be completely turned off (CPU HALT, frequency of 0) temporarily to
reduce the power consumption, and the frequency of cores changes regulary
depending on many factors like the workload and temperature. The power
consumption is now an important part in the design of modern CPUs.</p>
<p>Warning! This article is a summary of what I learnt last weeks from random
articles. It may be full of mistakes, don't hesitate to report them, so I can
enhance the article! It's hard to find simple articles explaining performances
of modern Intel CPUs, so I tried to write mine.</p>
<div class="section" id="tools-used-in-this-article">
<h2>Tools used in this article</h2>
<p>This article mentions various tools. Commands to install them on Fedora 24:</p>
<p><tt class="docutils literal">dnf install <span class="pre">-y</span> <span class="pre">util-linux</span></tt>:</p>
<ul class="simple">
<li>lscpu</li>
</ul>
<p><tt class="docutils literal">dnf install <span class="pre">-y</span> <span class="pre">kernel-tools</span></tt>:</p>
<ul class="simple">
<li><a class="reference external" href="http://linux.die.net/man/1/cpupower">cpupower</a></li>
<li>turbostat</li>
</ul>
<p><tt class="docutils literal">sudo dnf install <span class="pre">-y</span> <span class="pre">msr-tools</span></tt>:</p>
<ul class="simple">
<li>rdmsr</li>
<li>wrmsr</li>
</ul>
<p>Other interesting tools, not used in this article: i7z (sadly no more
maintained), lshw, dmidecode, sensors.</p>
<p>The sensors tool is supposed to report the current CPU voltage, but it doesn't
provide this information on my computers. At least, it gives the temperature of
different components, but also the speed of fans.</p>
</div>
<div class="section" id="example-of-intel-cpus">
<h2>Example of Intel CPUs</h2>
<div class="section" id="my-laptop-cpu-proc-cpuinfo">
<h3>My laptop CPU: /proc/cpuinfo</h3>
<p>On Linux, the most common way to retrieve information on the CPU is to read
<tt class="docutils literal">/proc/cpuinfo</tt>. Example on my laptop:</p>
<pre class="literal-block">
selma$ cat /proc/cpuinfo
processor  : 0
vendor_id  : GenuineIntel
model name : Intel(R) Core(TM) i7-3520M CPU &#64; 2.90GHz
cpu MHz    : 1200.214
...

processor  : 1
vendor_id  : GenuineIntel
model name : Intel(R) Core(TM) i7-3520M CPU &#64; 2.90GHz
cpu MHz    : 3299.882
...
</pre>
<p>&quot;i7-3520M&quot; CPU is a model designed for Mobile Platforms (see the &quot;M&quot; suffix).
It was built in 2012 and is the third generation of the Intel i7
microarchitecture: <a class="reference external" href="https://en.wikipedia.org/wiki/Ivy_Bridge_(microarchitecture)">Ivy Bridge</a>.</p>
<p>The CPU has two physical cores, I disabled HyperThreading in the BIOS.</p>
<p>The first strange thing is that the CPU announces &quot;2.90 GHz&quot; but Linux reports
1.2 GHz on the first core, and 3.3 GHz on the second core. 3.3 GHz is greater
than 2.9 GHz!</p>
</div>
<div class="section" id="my-desktop-cpu-cpu-topology-with-lscpu">
<h3>My desktop CPU: CPU topology with lscpu</h3>
<p>cpuinfo:</p>
<pre class="literal-block">
smithers$ cat /proc/cpuinfo
processor   : 0
physical id : 0
core id     : 0
...
model name  : Intel(R) Core(TM) i7-2600 CPU &#64; 3.40GHz
cpu cores   : 4
...

processor   : 1
physical id : 0
core id     : 1
...

(...)

processor   : 7
physical id : 0
core id     : 3
...
</pre>
<p>The CPU i7-2600 is the 2nd generation: <a class="reference external" href="https://en.wikipedia.org/wiki/Sandy_Bridge">Sandy Bridge microarchitecture</a>. There are 8 logical cores and 4
physical cores (so with Hyper-threading).</p>
<p>The <tt class="docutils literal">lscpu</tt> renders a short table which helps to understand the CPU topology:</p>
<pre class="literal-block">
smithers$ lscpu -a -e
CPU NODE SOCKET CORE L1d:L1i:L2:L3 ONLINE MAXMHZ    MINMHZ
0   0    0      0    0:0:0:0       yes    3800.0000 1600.0000
1   0    0      1    1:1:1:0       yes    3800.0000 1600.0000
2   0    0      2    2:2:2:0       yes    3800.0000 1600.0000
3   0    0      3    3:3:3:0       yes    3800.0000 1600.0000
4   0    0      0    0:0:0:0       yes    3800.0000 1600.0000
5   0    0      1    1:1:1:0       yes    3800.0000 1600.0000
6   0    0      2    2:2:2:0       yes    3800.0000 1600.0000
7   0    0      3    3:3:3:0       yes    3800.0000 1600.0000
</pre>
<p>There are 8 logical CPUs (<tt class="docutils literal">CPU <span class="pre">0..7</span></tt>), all on the same node (<tt class="docutils literal">NODE 0</tt>) and
the same socket (<tt class="docutils literal">SOCKET 0</tt>).  There are only 4 physical cores (<tt class="docutils literal">CORE
<span class="pre">0..3</span></tt>). For example, the physical core <tt class="docutils literal">2</tt> is made of the two logical CPUs:
<tt class="docutils literal">2</tt> and <tt class="docutils literal">6</tt>.</p>
<p>Using the <tt class="docutils literal">L1d:L1i:L2:L3</tt> column, we can see that each pair of two logical
cores share the same physical core caches for levels 1 (L1 data, L1
instruction) and 2 (L2).  All physical cores share the same cache level 3 (L3).</p>
</div>
</div>
<div class="section" id="p-states">
<h2>P-states</h2>
<p>A new CPU driver <tt class="docutils literal">intel_pstate</tt> was added to the Linux kernel 3.9 (April
2009). First, it only supported SandyBridge CPUs (2nd generation), Linux 3.10
extended it to Ivybridge generation CPUs (3rd gen), and so on and so forth.</p>
<p>This driver supports recent features and thermal control of modern Intel CPUs.
Its name comes from P-states.</p>
<p>The processor P-state is the capability of running the processor at different
voltage and/or frequency levels. Generally, P0 is the highest state resulting
in maximum performance, while P1, P2, and so on, will save power but at some
penalty to CPU performance.</p>
<p>It is possible to force the legacy CPU driver (<tt class="docutils literal">acpi_cpufreq</tt>) using
<tt class="docutils literal">intel_pstate=disable</tt> option in the kernel command line.</p>
<p>See also:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/intel-pstate.txt">Documentation of the intel-pstate driver</a></li>
<li><a class="reference external" href="https://plus.google.com/+ArjanvandeVen/posts/dLn9T4ehywL">Some basics on CPU P states on Intel processors</a> (2013) by Arjan
van de Ven (Intel)</li>
<li><a class="reference external" href="https://events.linuxfoundation.org/sites/events/files/slides/LinuxConEurope_2015.pdf">Balancing Power and Performance in the Linux Kernel</a>
talk at LinuxCon Europe 2015 by Kristen Accardi (Intel)</li>
<li><a class="reference external" href="https://software.intel.com/en-us/blogs/2008/05/29/what-exactly-is-a-p-state-pt-1">What exactly is a P-state? (Pt. 1)</a>
(2008) by Taylor K. (Intel)</li>
</ul>
</div>
<div class="section" id="idle-states-c-states">
<h2>Idle states: C-states</h2>
<p>C-states are idle power saving states, in contrast to P-states, which are
execution power saving states.</p>
<p>During a P-state, the processor is still executing instructions, whereas during
a C-state (other than C0), the processor is idle, meaning that nothing is
executing.</p>
<p>C-states:</p>
<ul class="simple">
<li>C0 is the operational state, meaning that the CPU is doing useful work</li>
<li>C1 is the first idle state</li>
<li>C2 is the second idle state: The external I/O Controller Hub blocks
interrupts to the processor.</li>
<li>etc.</li>
</ul>
<p>When a logical processor is idle (C-state except of C0), its frequency is
typically 0 (HALT).</p>
<p>The <tt class="docutils literal">cpupower <span class="pre">idle-info</span></tt> command lists supported C-states:</p>
<pre class="literal-block">
selma$ cpupower idle-info
CPUidle driver: intel_idle
CPUidle governor: menu
analyzing CPU 0:

Number of idle states: 6
Available idle states: POLL C1-IVB C1E-IVB C3-IVB C6-IVB C7-IVB
...
</pre>
<p>The <tt class="docutils literal">cpupower monitor</tt> shows statistics on C-states:</p>
<pre class="literal-block">
smithers$ sudo cpupower monitor -m Idle_Stats
    |Idle_Stats
CPU | POLL | C1-S | C1E- | C3-S | C6-S
   0|  0,00|  0,19|  0,09|  0,58| 96,23
   4|  0,00|  0,00|  0,00|  0,00| 99,90
   1|  0,00|  2,34|  0,00|  0,00| 97,63
   5|  0,00|  0,00|  0,17|  0,00| 98,02
   2|  0,00|  0,00|  0,00|  0,00|  0,00
   6|  0,00|  0,00|  0,00|  0,00|  0,00
   3|  0,00|  0,00|  0,00|  0,00|  0,00
   7|  0,00|  0,00|  0,00|  0,00| 49,97
</pre>
<p>See also: <a class="reference external" href="https://software.intel.com/en-us/articles/power-management-states-p-states-c-states-and-package-c-states">Power Management States: P-States, C-States, and Package C-States</a>.</p>
</div>
<div class="section" id="turbo-boost-1">
<h2>Turbo Boost</h2>
<p>In 2005, Intel introduced <a class="reference external" href="https://en.wikipedia.org/wiki/SpeedStep">SpeedStep</a>, a serie of dynamic frequency
scaling technologies to reduce the power consumption of laptop CPUs. Turbo
Boost is an enhancement of these technologies, now also used on desktop and
server CPUs.</p>
<p>Turbo Boost allows to run one or many CPU cores to higher P-states than usual.
The maximum P-state is constrained by the following factors:</p>
<ul class="simple">
<li>The number of active cores (in C0 or C1 state)</li>
<li>The estimated current consumption of the processor (Imax)</li>
<li>The estimated power consumption (TDP - Thermal Design Power) of processor</li>
<li>The temperature of the processor</li>
</ul>
<p>Example on my laptop:</p>
<pre class="literal-block">
selma$ cat /proc/cpuinfo
model name : Intel(R) Core(TM) i7-3520M CPU &#64; 2.90GHz
...

selma$ sudo cpupower frequency-info
analyzing CPU 0:
  driver: intel_pstate
  ...
  boost state support:
    Supported: yes
    Active: yes
    3400 MHz max turbo 4 active cores
    3400 MHz max turbo 3 active cores
    3400 MHz max turbo 2 active cores
    3600 MHz max turbo 1 active cores
</pre>
<p>The CPU base frequency is 2.9 GHz. If more than one physical cores is &quot;active&quot;
(busy), their frequency can be increased up to 3.4 GHz. If only 1 physical core
is active, its frequency can be increased up to 3.6 GHz.</p>
<p>In this example, Turbo Boost is supported and active.</p>
<p>See also the <a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/boost.txt">Linux cpu-freq documentation on CPU boost</a>.</p>
<div class="section" id="turbo-boost-msr">
<h3>Turbo Boost MSR</h3>
<p>The bit 38 of the <a class="reference external" href="https://en.wikipedia.org/wiki/Model-specific_register">Model-specific register
(MSR)</a> <tt class="docutils literal">0x1a0</tt> can
be used to check if the Turbo Boost is enabled:</p>
<pre class="literal-block">
selma$ sudo rdmsr -f 38:38 0x1a0
0
</pre>
<p><tt class="docutils literal">0</tt> means that Turbo Boost is enabled, whereas <tt class="docutils literal">1</tt> means disabled (no
turbo). (The <tt class="docutils literal"><span class="pre">-f</span> 38:38</tt> option asks to only display the bit 38.)</p>
<p>If the command doesn't work, you may have to load the <tt class="docutils literal">msr</tt> kernel module:</p>
<pre class="literal-block">
sudo modprobe msr
</pre>
<p>Note: I'm not sure that all Intel CPU uses the same MSR.</p>
</div>
<div class="section" id="intel-state-no-turbo">
<h3>intel_state/no_turbo</h3>
<p>Turbo Boost can also be disabled at runtime in the <tt class="docutils literal">intel_pstate</tt> driver.</p>
<p>Check if Turbo Boost is enabled:</p>
<pre class="literal-block">
selma$ cat /sys/devices/system/cpu/intel_pstate/no_turbo
0
</pre>
<p>where <tt class="docutils literal">0</tt> means that Turbo Boost is enabled. Disable Turbo Boost:</p>
<pre class="literal-block">
selma$ echo 1|sudo tee /sys/devices/system/cpu/intel_pstate/no_turbo
</pre>
</div>
<div class="section" id="cpu-flag-ida">
<h3>CPU flag &quot;ida&quot;</h3>
<p>It looks like the Turbo Boost status (supported or not) can also be read by the
CPUID(6): &quot;Thermal/Power Management&quot;. It gives access to the flag <a class="reference external" href="https://en.wikipedia.org/wiki/Intel_Dynamic_Acceleration">Intel
Dynamic Acceleration (IDA)</a>.</p>
<p>The <tt class="docutils literal">ida</tt> flag can also be seen in CPU flags of <tt class="docutils literal">/proc/cpuinfo</tt>.</p>
</div>
</div>
<div class="section" id="read-the-cpu-frequency">
<h2>Read the CPU frequency</h2>
<p>General information using <tt class="docutils literal">cpupower <span class="pre">frequency-info</span></tt>:</p>
<pre class="literal-block">
selma$ cpupower -c 0 frequency-info
analyzing CPU 0:
  driver: intel_pstate
  ...
  hardware limits: 1.20 GHz - 3.60 GHz
  ...
</pre>
<p>The frequency of CPUs is between 1.2 GHz and 3.6 GHz (the base frequency is
2.9 GHz on this CPU).</p>
<div class="section" id="get-the-frequency-of-cpus-turbostat">
<h3>Get the frequency of CPUs: turbostat</h3>
<p>It looks like the most reliable way to get a relialistic estimation of the CPUs
frequency is to use the tool <tt class="docutils literal">turbostat</tt>:</p>
<pre class="literal-block">
selma$ sudo turbostat
     CPU Avg_MHz   Busy% Bzy_MHz TSC_MHz
       -     224    7.80    2878    2893
       0     448   15.59    2878    2893
       1       0    0.01    2762    2893
     CPU Avg_MHz   Busy% Bzy_MHz TSC_MHz
       -     139    5.65    2469    2893
       0     278   11.29    2469    2893
       1       0    0.01    2686    2893
    ...
</pre>
<ul class="simple">
<li><tt class="docutils literal">Avg_MHz</tt>: average frequency, based on APERF</li>
<li><tt class="docutils literal">Busy%</tt>: CPU usage in percent</li>
<li><tt class="docutils literal">Bzy_MHz</tt>: busy frequency, based on MPERF</li>
<li><tt class="docutils literal">TSC_MHz</tt>: fixed frequency, TSC stands for <a class="reference external" href="https://en.wikipedia.org/wiki/Time_Stamp_Counter">Time Stamp Counter</a></li>
</ul>
<p>APERF (average) and MPERF (maximum) are MSR registers that can provide feedback
on current CPU frequency.</p>
</div>
<div class="section" id="other-tools-to-get-the-cpu-frequency">
<h3>Other tools to get the CPU frequency</h3>
<p>It looks like the following tools are less reliable to estimate the CPU
frequency.</p>
<p>cpuinfo:</p>
<pre class="literal-block">
selma$ grep MHz /proc/cpuinfo
cpu MHz : 1372.289
cpu MHz : 3401.042
</pre>
<p>In April 2016, Len Brown proposed a patch modifying cpuinfo to use APERF and
MPERF MSR to estimate the CPU frequency: <a class="reference external" href="https://lkml.org/lkml/2016/4/1/7">x86: Calculate MHz using APERF/MPERF
for cpuinfo and scaling_cur_freq</a>.</p>
<p>The <tt class="docutils literal">tsc</tt> clock source logs the CPU frequency in kernel logs:</p>
<pre class="literal-block">
selma$ dmesg|grep 'MHz processor'
[    0.000000] tsc: Detected 2893.331 MHz processor
</pre>
<p>cpupower frequency-info:</p>
<pre class="literal-block">
selma$ for core in $(seq 0 1); do sudo cpupower -c $core frequency-info|grep 'current CPU'; done
  current CPU frequency: 3.48 GHz (asserted by call to hardware)
  current CPU frequency: 3.40 GHz (asserted by call to hardware)
</pre>
<p>cpupower monitor:</p>
<pre class="literal-block">
selma$ sudo cpupower monitor -m 'Mperf'
    |Mperf
CPU | C0   | Cx   | Freq
   0|  4.77| 95.23|  1924
   1|  0.01| 99.99|  1751
</pre>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Modern Intel CPUs use various technologies to provide best performances without
killing the power consumption. It became harder to monitor and understand CPU
performances, than with older CPUs, since the performance now depends on much
more factors.</p>
<p>It also becomes common to get an integrated graphics processor (IGP) in the
same package, which makes the exact performance even more complex to predict,
since the IGP produces heat and so has an impact on the CPU P-state.</p>
<p>I should also explain that P-state are &quot;voted&quot; between CPU cores, but I didn't
understand this part. I'm not sure that understanding the exact algorithm
matters much. I tried to not give too much information.</p>
</div>
<div class="section" id="annex-amt-and-the-me-power-management-coprocessor">
<h2>Annex: AMT and the ME (power management coprocessor)</h2>
<p>Computers with Intel vPro technology includes <a class="reference external" href="https://en.wikipedia.org/wiki/Intel_Active_Management_Technology">Intel Active Management
Technology (AMT)</a>: &quot;hardware
and firmware technology for remote out-of-band management of personal
computers&quot;. AMT has many features which includes power management.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Intel_Active_Management_Technology#Hardware">Management Engine (ME)</a>
is the hardware part: an isolated and protected coprocessor, embedded as a
non-optional part in all current (as of 2015) Intel chipsets. The coprocessor
is a special 32-bit ARC microprocessor (RISC architecture) that's physically
located inside the PCH chipset (or MCH on older chipsets). The coprocessor can
for example be found on Intel MCH chipsets Q35 and Q45.</p>
<p>See <a class="reference external" href="https://boingboing.net/2016/06/15/intel-x86-processors-ship-with.html">Intel x86s hide another CPU that can take over your machine (you can't
audit it)</a> for
more information on the coprocessor.</p>
<p>More recently, the Intel Xeon Phi CPU (2016) also includes a coprocessor for
power management. I didn't understand if it is the same coprocessor or not.</p>
</div>
</div>
	<hr>
	<h2>Comments</h2>
</div>
		</div>
	</div> 	<!-- <hr> -->
</div> <!-- /container -->
<footer class="aw-footer bg-danger">
	<div class="container"> <!-- footer -->
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-3">
						<h4>Navigation</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://vstinner.github.io">Victor Stinner blog 3</a></li>
							<li><a href="https://vstinner.github.io/feeds/all.atom.xml" type="application/atom+xml"><i class="fa fa-rss "></i> atom</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Author</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://twitter.com/VictorStinner">Follow @VictorStinner on Twitter</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Categories</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://vstinner.github.io/category/benchmark.html">benchmark (8)</a></li>
							<li><a href="https://vstinner.github.io/category/cpython.html">cpython (17)</a></li>
							<li><a href="https://vstinner.github.io/category/linux.html">linux (2)</a></li>
							<li><a href="https://vstinner.github.io/category/python.html">python (41)</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Links</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="http://vstinner.readthedocs.org/">Victor Stinner's Notes</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; Victor Stinner 2016</p>
			<p>Powered by Pelican</p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
</body>
</html>