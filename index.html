<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Victor Stinner blog 3</title>
	<meta name="description" content="Coding, scientific development, finance, data analysis, visualization, statistics, and machine learning">
	<meta name="author" content="Victor Stinner">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="https://vstinner.github.io/theme/html5.js"></script>
		<![endif]-->
	<link href="https://vstinner.github.io/theme/css/ipython.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="https://vstinner.github.io/theme/css/local.css" rel="stylesheet">
	<link href="https://vstinner.github.io/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<div class="page-header">
		<h1><a href="https://vstinner.github.io/">Victor Stinner blog 3</a>
			<br>	</div>
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
        
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/c-api-convert-macros-functions.html">
		<h2 itemprop="name headline">Convert macros to functions in the Python C API</h2>
	</a>
	<time datetime="2022-12-12T23:00:00+01:00" itemprop="datePublished">lun. 12 décembre 2022</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><a class="reference external image-reference" href="https://www.exemplaire-editions.fr/librairie/livre/loeil-du-cyclone"><img alt="L'oeil du cyclone - Théo Grosjean" src="https://vstinner.github.io/images/loeil_cyclone.jpg" /></a>
<p><em>Drawing: &quot;L'oeil du cyclone&quot; by Théo Grosjean.</em></p>
<div class="section" id="convert-macros-to-functions">
<h2>Convert macros to functions</h2>
<p>For 4 years, between Python 3.7 (2018) and Python 3.12 (2022), I made many
changes on macros in the Python C API to make the API less error prone (avoid
<a class="reference external" href="https://gcc.gnu.org/onlinedocs/cpp/Macro-Pitfalls.html">macro pitfalls</a>) and
better define the API …</p></div></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/c-api.html" rel="tag">c-api</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/debug-python-refleak.html">
		<h2 itemprop="name headline">Debug a Python reference leak</h2>
	</a>
	<time datetime="2022-11-04T13:00:00+01:00" itemprop="datePublished">ven. 04 novembre 2022</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><a class="reference external image-reference" href="https://twitter.com/djamilaknopf/status/1587441869403099136"><img alt="Childhood memories in the countryside" src="https://vstinner.github.io/images/refleak.jpg" /></a>
<p>This morning, I got <a class="reference external" href="https://mail.python.org/archives/list/buildbot-status&#64;python.org/message/MU2EJRTFF4ZCYTDXYER7KCL3IQUM5F3T/">this email</a>
from the buildbot-status mailing list:</p>
<blockquote>
The Buildbot has detected a new failure on builder PPC64LE Fedora Rawhide
<strong>Refleaks</strong> 3.x while building Python.</blockquote>
<p>I get many of buildbot failures per month (by email), but I like to debug
reference leaks: they are more challenging …</p></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/refleak.html" rel="tag">refleak</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/c-api-abstract-pyobject.html">
		<h2 itemprop="name headline">Python C API: Add functions to access PyObject</h2>
	</a>
	<time datetime="2021-10-05T14:00:00+02:00" itemprop="datePublished">mar. 05 octobre 2021</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><a class="reference external image-reference" href="https://twitter.com/Kekeflipnote/status/1433139994516934663"><img alt="A spider in my bedroom" src="https://vstinner.github.io/images/spider.png" /></a>
<p>The PyObject structure prevents indirectly to optimize CPython. We will see why
and how I prepared the C API to make this structure opaque. It took me 1 year
and a half to add functions and to introduce <strong>incompatible C API changes</strong>
(fear!).</p>
<p>In February 2020, I started by adding …</p></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/c-api.html" rel="tag">c-api</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/c-api-python3_10-changes.html">
		<h2 itemprop="name headline">C API changes between Python 3.5 to 3.10</h2>
	</a>
	<time datetime="2021-10-04T15:00:00+02:00" itemprop="datePublished">lun. 04 octobre 2021</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><img alt="Homer Simpson hiding" src="https://vstinner.github.io/images/homer_hiding.webp" />
<p>I'm trying to enhance and to fix the Python C API for 5 years. My first goal
was to shrink the C API without breaking third party C extensions. I hid many
private functions from the public functions: I moved them to the &quot;internal C
API&quot;. I also deprecated and …</p></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/c-api.html" rel="tag">c-api</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/pythoncapi_compat.html">
		<h2 itemprop="name headline">Creation of the pythoncapi_compat project</h2>
	</a>
	<time datetime="2021-03-30T20:00:00+02:00" itemprop="datePublished">mar. 30 mars 2021</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><a class="reference external image-reference" href="https://twitter.com/Kekeflipnote/status/1378034391872638980"><img alt="Strange Cat by Kéké" src="https://vstinner.github.io/images/strange_cat.jpg" /></a>
<p>In 2020, I created a new <a class="reference external" href="https://github.com/pythoncapi/pythoncapi_compat">pythoncapi_compat project</a> to add Python 3.10 support
to C extensions without losing support for old Python versions. It supports
Python 2.7-3.10 and PyPy 2.7-3.7. The project is made of two parts:</p>
<ul class="simple">
<li><tt class="docutils literal">pythoncapi_compat.h</tt>: Header file providing new C API …</li></ul></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/c-api.html" rel="tag">c-api</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/c-api-opaque-structures.html">
		<h2 itemprop="name headline">Make structures opaque in the Python C API</h2>
	</a>
	<time datetime="2021-03-26T12:00:00+01:00" itemprop="datePublished">ven. 26 mars 2021</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><a class="reference external image-reference" href="https://fr.wikipedia.org/wiki/Incendie_du_centre_de_donn%C3%A9es_d%27OVHcloud_%C3%A0_Strasbourg"><img alt="OVHcloud datacenter fire in Strasbourg" src="https://vstinner.github.io/images/incendie-ovh.jpg" /></a>
<p>This article is about changes that I made, with the help other developers, in
the Python C API in Python 3.8, 3.9 and 3.10 to avoid accessing structures
members: prepare the C API to <a class="reference external" href="https://en.wikipedia.org/wiki/Opaque_data_type">make structures opaque</a>. These changes are related
to my <a class="reference external" href="https://www.python.org/dev/peps/pep-0620/">PEP 620 &quot;Hide implementation …</a></p></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/c-api.html" rel="tag">c-api</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/isolate-subinterpreters.html">
		<h2 itemprop="name headline">Isolate Python Subinterpreters</h2>
	</a>
	<time datetime="2020-12-27T22:00:00+01:00" itemprop="datePublished">dim. 27 décembre 2020</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><img alt="Christmas gift." src="https://vstinner.github.io/images/christmas-gift.jpg" />
<p>This article is about the work done in Python in 2019 and 2020 to better
isolate subinterpreters. Static types are converted to heap types, extension
modules are converted to use the new multiphase initialization API (PEP 489),
caches, states, singletons and free lists are made per-interpreter, many bugs
have been …</p></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/subinterpreters.html" rel="tag">subinterpreters</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/hide-implementation-details-python-c-api.html">
		<h2 itemprop="name headline">Hide implementation details from the Python C API</h2>
	</a>
	<time datetime="2020-12-25T22:00:00+01:00" itemprop="datePublished">ven. 25 décembre 2020</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><img alt="My cat attacking the Python C API" src="https://vstinner.github.io/images/pepsie.jpg" />
<p>This article is the history of Python C API discussions over the last 4 years,
and the creation of C API projects: <a class="reference external" href="https://pythoncapi.readthedocs.io/">pythoncapi website</a>, <a class="reference external" href="https://github.com/pythoncapi/pythoncapi_compat">pythoncapi_compat.h header file</a> and <a class="reference external" href="https://hpy.readthedocs.io/">HPy (new clean C API)</a>. More and more people are aware of issues
caused by the C API and are working …</p></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/optimization.html" rel="tag">optimization</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/c-api.html" rel="tag">c-api</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/subinterpreter-leaks.html">
		<h2 itemprop="name headline">Leaks discovered by subinterpreters</h2>
	</a>
	<time datetime="2020-12-23T14:00:00+01:00" itemprop="datePublished">mer. 23 décembre 2020</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><p>This article is about old reference leaks discovered or caused by the work on
isolating subinterpreters: leaks in 6 different modules (gc, _weakref, _abc,
_signal, _ast and _thread).</p>
<img alt="_thread GC bug" src="https://vstinner.github.io/images/thread_gc_bug.jpg" />
<div class="section" id="refleaks-buildbot-failures">
<h2>Refleaks buildbot failures</h2>
<p>With my work on isolating subinterpreters, old bugs about Python objects leaked
at Python exit are suddenly becoming blocker …</p></div></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/subinterpreters.html" rel="tag">subinterpreters</a>
	</span>
</div>
<hr>
        
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<a href="https://vstinner.github.io/gil-bugfixes-daemon-threads-python39.html">
		<h2 itemprop="name headline">GIL bugfixes for daemon threads in Python 3.9</h2>
	</a>
	<time datetime="2020-04-04T22:00:00+02:00" itemprop="datePublished">sam. 04 avril 2020</time>
	&nbsp;—&nbsp;
	<span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
		<span itemprop="name">Victor Stinner</span>
	</span>
	<div class="summary"><a class="reference external image-reference" href="https://twitter.com/Bouletcorp/status/1241018332112998401"><img alt="`#CoronaMaison by Boulet" src="https://vstinner.github.io/images/coronamaison_boulet.jpg" /></a>
<p>My previous article <a class="reference external" href="https://vstinner.github.io/daemon-threads-python-finalization-python32.html">Daemon threads and the Python finalization in Python 3.2 and 3.3</a> introduces
issues caused by daemon threads in the Python finalization and past changes to
make them work.</p>
<p>This article is about bugfixes of the infamous GIL (Global Interpreter Lock) in
Python 3.9, between …</p></div>
	Category:
	<span itemprop="articleSection">
		<a href="https://vstinner.github.io/category/cpython.html" rel="category">cpython</a>
	</span>
	Tags:
 
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/cpython.html" rel="tag">cpython</a>
	</span>
	<span itemprop="keywords">
		<a href="https://vstinner.github.io/tag/subinterpreters.html" rel="tag">subinterpreters</a>
	</span>
</div>
<hr>
 <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="https://vstinner.github.io/index.html">1</a></li>
    <li class=""><a href="https://vstinner.github.io/index2.html">2</a></li>
    <li class=""><a href="https://vstinner.github.io/index3.html">3</a></li>
    <li class=""><a href="https://vstinner.github.io/index4.html">4</a></li>
    <li class=""><a href="https://vstinner.github.io/index5.html">5</a></li>
    <li class=""><a href="https://vstinner.github.io/index6.html">6</a></li>
    <li class=""><a href="https://vstinner.github.io/index7.html">7</a></li>

    <li class="next"><a href="https://vstinner.github.io/index2.html">Next &rarr;</a></li>

</ul>
</div> 		</div>
	</div> 	<!-- <hr> -->
</div> <!-- /container -->
<footer class="aw-footer bg-danger">
	<div class="container"> <!-- footer -->
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-3">
						<h4>Navigation</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://vstinner.github.io">Victor Stinner blog 3</a></li>
							<li><a href="https://vstinner.github.io/feeds/all.atom.xml" type="application/atom+xml"><i class="fa fa-rss "></i> atom</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Author</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://twitter.com/VictorStinner">Follow @VictorStinner on Twitter</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Categories</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://vstinner.github.io/category/benchmark.html">benchmark (8)</a></li>
							<li><a href="https://vstinner.github.io/category/cpython.html">cpython (18)</a></li>
							<li><a href="https://vstinner.github.io/category/linux.html">linux (2)</a></li>
							<li><a href="https://vstinner.github.io/category/python.html">python (41)</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Links</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="http://vstinner.readthedocs.org/">Victor Stinner's Notes</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; Victor Stinner 2016</p>
			<p>Powered by Pelican</p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
</body>
</html>